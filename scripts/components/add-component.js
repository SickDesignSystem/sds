import {
  text,
  spinner
} from '@clack/prompts';
import fs from 'fs';
import path from 'path';
import 'dotenv/config';
import { saveConfig } from '../basics/config.js';
import { resetAutogeneratedFiles } from './reset-autogenerated-files.js';

const s = spinner();

export const addComponent = async (config) => {
  const newComponent = await text({
    message: 'Which component would you like to install?',
    placeholder: 'e. g. "alert"',
    validate(value) {
      const availableComponents = fs.readdirSync(path.join(config.vendorPath, 'src', 'components'), { withFileTypes: true })
        .filter(dirent => dirent.isDirectory())
        .map(dirent => dirent.name);
      // check if value is in availableComponents
      if (!availableComponents.includes(value)) return 'Component not found in Shoelace';
    },
  });
  if (!newComponent) return;

  config.components = [...(config.components || []), newComponent].sort();
  saveConfig(config);

  await resetAutogeneratedFiles(config);
}
