import fs from 'fs/promises';
import path from 'path';
import { job, ucFirstLetter } from './shared.js';
import { components } from '../config.js';

/**
 * This function will create the src/synergy.ts file out of available components
 */
export const runCreateExports = job('Creating component exports in src/synergy.ts...', async (componentsDir) => {
  const synergyMainFile = path.join(componentsDir, 'src/synergy.ts');

  // Get the export list for of all components
  // and write them out in alphabetical order
  const exportList = [...components]
    .sort()
    .map(c => `export { default as Syn${ucFirstLetter(c)} } from './components/${c}/${c}.js';`);

  const otherExports = `
// Utilities
// export * from './utilities/animation.js';
// export * from './utilities/base-path.js';
// export * from './utilities/icon-library.js';
export * from './utilities/form.js';

// Events
export * from './events/events.js';
`;

  const output = [
    '// !!! This file is automatically generated via scripts/build.js',
    '// !!! Changes you apply to this file will get lost',
    '// !!! Please add your wanted changes to scripts/jobs/createExports.js',
    '// !!! and run `pnpm build` to recreate this file',
    '',
    '// Components',
    exportList.join('\n'),
    otherExports,
  ].join('\n');

  await fs.writeFile(synergyMainFile, output);
});
